<template>
    <ul class="fileList list-inline">
        <li v-for="item in list" :key="item">
         <a class="boxer" :href="item.fullUrl" v-boxer="item.fullUrl" >
            <i class="masterCert" v-if="isMaster">主图</i>
            <img :src="item.thumbnail" :width="width" :height="width">
        </a>
        <p class="text-center" v-if="showChoose">
            <input type="radio" v-model="checked" :value="item.url" />
        </p>
        </li>
    </ul>
</template>
<script>
import { changeImgSize, getFileType } from '~/global.common'; // 文件格式
import pdf from '@/assets/images/pdf.png'; // daf
import defaultImg from '@/assets/images/noimage.png';
import '@/utils/directive/boxer.js'; // jq boxer指令
export default {
    data () {
        return {
            checked: '',
            width: '',
            list: []
        };
    },
    props: {
        isMaster: false,
        showChoose: '',
        files: {
            type: [Array, String]
        },
        size: {
            type: String
        }
    },
    beforeMount () {
        this.init();
        switch (this.size) {
        case 'small':
            this.width = 60;
            break;
        case 'mini':
            this.width = 32;
            break;
        default:
            this.width = 100;
            break;
        }
    },
    watch: {
        checked () {
            this.$emit('changeChecked', this.checked);
        },
        files (val, oldVal) {
            this.init();
        }
    },
    methods: {
        init () {
            let src; 
            if (this.files) {
                src = (typeof this.files === 'string' ? this.files.split(';') : (this.files instanceof Array ? this.files : null));
            }
            this.list = [];
            src && src.forEach(item => {
                this.list.push(this.formatFile(item));
            });
        },
        // 格式化文件
        formatFile (item, uid) {
            let thumbnail;
            switch (getFileType(item)) {
            case 'image':
                thumbnail = process.env.IMAGE_DOWNLOAD + changeImgSize(item);
                break;
            case 'pdf':
                thumbnail = pdf;
                break;
            case 'other':
                thumbnail = defaultImg;
                break;
            default:
                thumbnail = defaultImg;
                break;
            }
            return {
                thumbnail: thumbnail,
                fullUrl: process.env.IMAGE_DOWNLOAD + item,
                url: item
            };
        }
    }
};
</script>
<style lang="scss">
    .fileList{
        li{
            float:left;
            margin-right:5px;
            position:relative;
            .masterCert{
                position: absolute;
                background-color: rgba(255,0,0,.8);
                color: #fff;
                font-style: normal;
                padding: 0px 5px;
                line-height: 18px;
            }
        }
    }
</style>
